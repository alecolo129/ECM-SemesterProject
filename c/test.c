#include "ecm.h"

Curve curves_11[ANOMALOUS_11_SIZE];

char *Ns_11[10] = {
    "11012058211194356190344506285262282884213050374208669255773592419763272060198039383311999417415151844787510376240198556627389671089704320582855991314813773557990757699810217556401340289976022622179196927176213637846589610827918084376479017342240107823582484945402153901581112454992504630992355155886150767103252067235452136105842098917689208446363697731907011252022101183550131332985080835006071427997598615018638669082194521360124608902495258122324242145191885551",
    "9635014380829818513919575640152133208097449135090538680719732265693550242570074277093186834104727144476168111576825048395706692711927529503565791270791961097125972125082977430988457409016787038592395699705812580051707900361632165314161496493628102150554677471934940960479909747328875344589720387691217376260998809845320682983933568485472901418138569406525909452766210043076342735125191418469062798755968739460296396752783589497338924163119013900917336366184687967",
    "5069017787463605972000654823124291360314041891550691707641945563187031076505253852394808071946749220276817760352946766005493095589841248937768392784128858273880545371569842793666802133707622974139543664284571783031334517727967129296361906281713281890159210266353915098573927262551284657187535512793571176035025141522172904448808033909251513020960449454148197333465651240812780461565090849154826129876818590610191072726239882331414819713967484249216015745283616289",
    "7469792113910115366282290012741954344269745225023951297988121734862910010946546291714418856629923428957631821337853046085844627299405870888213166260926463142691146004510107310219750215993535742699474329823437034047346182191453488481475327585589630263638595265890409060010152935475220259282363495698686064888258637560800360609857070267527757029441053050466241965940240294856256481012231161217576936962918714565963317744158165383319588380755249032718147123694785863",
    "17439381801204076807915988853488472094923889343103015878371708473265475736911713264976165107274944935978461341219748890177451984117415859739628195168786651115347662840586378952645049573670262117319274949632136807668015344488384704597000847714140632811885338271971576326967678160931291567572483415736431917934730130342097341274570108866763209531152278705524050349490360504326595815171384231460285964205024437413675162461413702504083715271258784124289776218447576283",
    "32530754496327136963557971767584023896924389918270872370455200932378207233345327834677541020790413997396839504385140237152267605104394878370460253018406212837425102076067785708770373386139624717760261938109429098815167783674306563936441985560668421081643853120466110337932684979505918726764915021990069612261979131303999668224089217879984549797962379405015934975373958781542687625841212795401521387081923354964427034754909615730500485820534934370331881902763148113",
    "43967077910433196852057054372573329065740582259718979000814244964441086564379046248134818497856664562044261219988369866873919660665032454029354211427196472817913517131542977156812087149205536981015821660685502703083306116068531523095042005903243235967586215157814431222594806677330983615374115090469202208087256414730806517735840262140312832797109763318780170561714795594444377501366109548351951007962733525646420416814410348985379573809267200353260305979825829019",
    "28057765493067324287147072269104149076772042811304674349361398099885616220455782868331713543349116504842067586576801736510063617461426679533778752181820504475528010397767900187660206245404802083265931082093853201370954613688424614356054334132937658325546815021592182761703125954554288902223000954172917942017375503235784344104197294116964716704907225313251769792200914962376289470859878123585565851021706195064788295875360077527282701829291779217337888556644314787",
    "38645695380519055235934848658078828358537589637088131159058910444673960679308209543019150466151764444983866233646523054787095387749075830758850237653467860770482021259882656378665114531018267853286604426778241075292798930747881297730473715072496765641892380693266157694717205454128695772636583129928300323368322554548037977959344272424773846991291351168701290630572938857218009436688215168695121627288495059202346004803828792274009392340085861968932344258470150787",
    "46160945438380225385956045709501048963350934675055277135249078191046812834173245566893963003475282236656249088423274511951386516701875127040748056038817882926540086874721120690860853580309886314717083136139731170979145145439274348682758609772348244264528948134785625895360485901789732880718548010005609723414243386369909673087161108789731343485286405589404241921897280859891114132991678232014882198356984312451190399008386844793656558806185490147685951548091505403"};

void init_curves_11()
{
    for (int i = 0; i < ANOMALOUS_11_SIZE; i++)
    {
        mpz_inits(curves_11[i].a, curves_11[i].b, curves_11[i].point.x, curves_11[i].point.y, NULL);
    }
}
void set_curves_11(mpz_t N)
{
    mpz_t temp;
    mpz_init(temp);

    for (int i = 0; i < ANOMALOUS_11_SIZE; i++)
    {
        //------Init Curve ------
        mpz_set_str(curves_11[i].a, CURVES_ANOMALOUS_11[i][0][0], 10); // set a
        mpz_set_str(curves_11[i].b, CURVES_ANOMALOUS_11[i][0][1], 10); // set b

        //------ Init Point ------
        // set x coordinate
        mpz_set_str(curves_11[i].point.x, CURVES_ANOMALOUS_11[i][1][0], 10);
        mpz_set_str(temp, CURVES_ANOMALOUS_11[i][1][1], 10);

        // if x coordinate is rational we need to invert modulus N
        if (mpz_cmp_si(temp, 1))
        {
            mpz_invert(temp, temp, N);
            mpz_mul(curves_11[i].point.x, curves_11[i].point.x, temp);
            // gmp_printf("x=%Zd temp=%Zd, N=%Zd\n",curves_11[i].point.x, temp, N);
            mpz_mod(curves_11[i].point.x, curves_11[i].point.x, N);
        }

        // set y coordinate
        mpz_set_str(curves_11[i].point.y, CURVES_ANOMALOUS_11[i][1][2], 10);
        mpz_set_str(temp, CURVES_ANOMALOUS_11[i][1][3], 10);
        // if y coordinate is rational we need to invert modulus N
        if (mpz_cmp_si(temp, 1))
        {
            mpz_invert(temp, temp, N);
            mpz_mul(curves_11[i].point.y, curves_11[i].point.y, temp);
            mpz_mod(curves_11[i].point.y, curves_11[i].point.y, N);
        }
        // set z coordinate
        curves_11[i].point.z = 1;
    }

    mpz_clear(temp);
}

void test_anomalous_moduli_11()
{
    mpz_t N;
    clock_t t1, t2;

    for (int n = 0; n < 10; n++)
    {

        mpz_init_set_str(N, Ns_11[n], 10);
        set_curves_11(N);
        printf("#####################################################\nTrying N%d...\n", n);
        gmp_printf("N=%Zd\n", N);
        t1 = clock();
        for (int c = 0; c < ANOMALOUS_11_SIZE; c++)
        {
            printf("curve ...%d\n", c);
            if (ECM_anomalous(&curves_11[c], N) != -1)
                break;
        }
        t2 = clock();
        printf("time = %f\n", ((double)t2 - t1) / CLOCKS_PER_SEC);
    }
}

int main(int argc, char **argv)
{
    init_curves_11();
    test_anomalous_moduli_11();

    return 0;
}